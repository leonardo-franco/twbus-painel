<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Painel interativo para informa√ß√µes de parada de √¥nibus em tempo real">
    <meta name="keywords" content="√¥nibus, transporte p√∫blico, parada, tempo real, S√£o Paulo">
    <meta name="author" content="TwBus">
    
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; font-src 'self' https://cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self' https://twbus.vercel.app; worker-src 'self'; manifest-src 'self'; frame-ancestors 'none'; base-uri 'self'; form-action 'self'; object-src 'none'; media-src 'none'; child-src 'none';">
    
    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="icon.svg">
    <link rel="icon" type="image/png" href="icon-512.svg">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Security Configuration -->
    <script src="security-config.js"></script>
    
    <title>TwBus - Painel de Parada</title>
</head>
<body>
    <!-- Indicadores de sistema -->
    <div id="system-indicators" class="system-indicators"></div>
    
    <!-- Banner de instala√ß√£o PWA -->
    <div id="installBanner" class="install-banner">
        <div class="banner-content">
            <div class="banner-text">
                <strong>üì± Instalar TwBus</strong>
                <span>Acesse offline e receba notifica√ß√µes</span>
            </div>
            <div class="banner-actions">
                <button id="installBannerBtn" class="btn-install">Instalar</button>
                <button id="dismissBannerBtn" class="btn-dismiss">‚úï</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Cabe√ßalho com n√∫mero e tempo -->
        <div class="header">
            <div class="bus-info">
                <div class="bus-number">
                    <i class="fas fa-bus"></i>
                    <span class="number">174</span>
                </div>
                <div class="divider"></div>
                <div class="arrival-time">
                    <i class="fas fa-clock"></i>
                    <span class="time">5 min</span>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o da rota -->
        <div class="route-section">
            <div class="section-header">
                <h3><i class="fas fa-route"></i> Rota do √înibus</h3>
                <div class="route-controls">
                    <button class="control-btn" id="refreshBtn" title="Atualizar informa√ß√µes" aria-label="Atualizar informa√ß√µes">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="control-btn" id="expandBtn" title="Expandir/Recolher rota" aria-label="Expandir ou recolher rota">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
            <div class="route-container">
                <div class="route-line">
                    <!-- Paradas anteriores (vis√≠veis apenas no modo expandido) -->
                    <div class="stop passed extra hidden">
                        <div class="stop-icon"></div>
                        <div class="stop-info">
                            <span class="stop-name">Terminal Barra Funda</span>
                            <span class="stop-status">Passou</span>
                        </div>
                    </div>
                    
                    <div class="stop passed extra hidden">
                        <div class="stop-icon"></div>
                        <div class="stop-info">
                            <span class="stop-name">Memorial da Am√©rica Latina</span>
                            <span class="stop-status">Passou</span>
                        </div>
                    </div>
                    
                    <div class="stop passed extra hidden">
                        <div class="stop-icon"></div>
                        <div class="stop-info">
                            <span class="stop-name">Esta√ß√£o Marechal Deodoro</span>
                            <span class="stop-status">Passou</span>
                        </div>
                    </div>
                    
                    <!-- Paradas principais (sempre vis√≠veis) -->
                    <div class="stop passed">
                        <div class="stop-icon"></div>
                        <div class="stop-info">
                            <span class="stop-name">Pra√ßa da S√©</span>
                            <span class="stop-status">Passou</span>
                        </div>
                    </div>
                    
                    <div class="stop current-bus highlighted">
                        <div class="stop-icon">
                            <i class="fas fa-bus"></i>
                        </div>
                        <div class="stop-info">
                            <span class="stop-name">Rua J√∫lio Mesquita</span>
                            <span class="stop-status">√înibus aqui</span>
                        </div>
                    </div>
                    
                    <div class="stop next">
                        <div class="stop-icon"></div>
                        <div class="stop-info">
                            <span class="stop-name">Av. S√£o Jo√£o</span>
                            <span class="stop-status">Pr√≥xima</span>
                        </div>
                    </div>
                    
                    <div class="stop current-location highlighted">
                        <div class="stop-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="stop-info">
                            <span class="stop-name">√ìpera</span>
                            <span class="stop-status">Voc√™ est√° aqui</span>
                        </div>
                    </div>
                    
                    <div class="stop upcoming">
                        <div class="stop-icon"></div>
                        <div class="stop-info">
                            <span class="stop-name">Esta√ß√£o da Luz</span>
                            <span class="stop-status">Ap√≥s voc√™</span>
                        </div>
                    </div>
                    
                    <div class="stop upcoming">
                        <div class="stop-icon"></div>
                        <div class="stop-info">
                            <span class="stop-name">Pinacoteca</span>
                            <span class="stop-status">Ap√≥s voc√™</span>
                        </div>
                    </div>
                    
                    <div class="stop upcoming">
                        <div class="stop-icon"></div>
                        <div class="stop-info">
                            <span class="stop-name">Jardim da Luz</span>
                            <span class="stop-status">Ap√≥s voc√™</span>
                        </div>
                    </div>
                    
                    <!-- Paradas posteriores (vis√≠veis apenas no modo expandido) -->
                    <div class="stop upcoming extra hidden">
                        <div class="stop-icon"></div>
                        <div class="stop-info">
                            <span class="stop-name">Esta√ß√£o Tiradentes</span>
                            <span class="stop-status">Ap√≥s voc√™</span>
                        </div>
                    </div>
                    
                    <div class="stop upcoming extra hidden">
                        <div class="stop-icon"></div>
                        <div class="stop-info">
                            <span class="stop-name">Mercado Municipal</span>
                            <span class="stop-status">Ap√≥s voc√™</span>
                        </div>
                    </div>
                    
                    <div class="stop upcoming extra hidden">
                        <div class="stop-icon"></div>
                        <div class="stop-info">
                            <span class="stop-name">Rua 25 de Mar√ßo</span>
                            <span class="stop-status">Ap√≥s voc√™</span>
                        </div>
                    </div>
                    
                    <div class="stop upcoming extra hidden">
                        <div class="stop-icon"></div>
                        <div class="stop-info">
                            <span class="stop-name">Terminal Parque Dom Pedro</span>
                            <span class="stop-status">Final</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o de informa√ß√µes adicionais -->
        <div class="info-section">
            <div class="info-card">
                <div class="info-item">
                    <i class="fas fa-users"></i>
                    <div class="info-content">
                        <span class="info-label">Lugares livres</span>
                        <span class="info-value available">12</span>
                    </div>
                </div>
                <div class="info-divider"></div>
                <div class="info-item">
                    <i class="fas fa-bus"></i>
                    <div class="info-content">
                        <span class="info-label">Pr√≥ximo √¥nibus</span>
                        <span class="info-value next-bus">15 min</span>
                    </div>
                </div>
            </div>
            <div class="additional-info">
                <div class="info-badge">
                    <i class="fas fa-wifi"></i>
                    <span>Wi-Fi dispon√≠vel</span>
                </div>
                <div class="info-badge">
                    <i class="fas fa-wheelchair"></i>
                    <span>Acess√≠vel</span>
                </div>
            </div>
        </div>

        <!-- Rodap√© -->
        <div class="footer">
            <div class="update-time">
                <i class="fas fa-sync-alt"></i>
                <span>Atualizado: 14:32</span>
            </div>
            <div class="admin-access admin-relative">
                <button id="adminBtn" class="admin-btn" title="Acesso Administrativo">
                    ‚öôÔ∏è
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts modernos com m√≥dulos ES6 -->
    <script type="module" src="src/app.js"></script>
    <script src="tests.js"></script>
    
    <!-- Fallback para navegadores sem suporte a m√≥dulos -->
    <script nomodule src="script.js"></script>
    
    <!-- Script de emerg√™ncia para funcionalidade de expandir -->
    <script>
        // Garantir que a funcionalidade de expandir funcione independentemente
        function initExpandFunctionality() {
            const expandBtn = document.getElementById('expandBtn');
            const container = document.querySelector('.container');
            
            if (expandBtn && container && !expandBtn.hasAttribute('data-initialized')) {
                let isExpanded = false;
                
                expandBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Toggle expanded state
                    isExpanded = !isExpanded;
                    
                    if (isExpanded) {
                        container.classList.add('expanded');
                        expandBtn.innerHTML = '<i class="fas fa-compress" aria-hidden="true"></i>';
                        expandBtn.setAttribute('aria-label', 'Contrair painel');
                        
                        // Show extra stops
                        const extraStops = document.querySelectorAll('.stop.extra');
                        extraStops.forEach((stop, index) => {
                            stop.classList.remove('hidden');
                            // Adicionar delay progressivo para anima√ß√£o
                            setTimeout(() => {
                                stop.style.display = 'flex';
                                stop.style.opacity = '1';
                                stop.style.transform = 'translateX(0)';
                            }, index * 100);
                        });
                    } else {
                        container.classList.remove('expanded');
                        expandBtn.innerHTML = '<i class="fas fa-expand" aria-hidden="true"></i>';
                        expandBtn.setAttribute('aria-label', 'Expandir painel');
                        
                        // Hide extra stops
                        const extraStops = document.querySelectorAll('.stop.extra');
                        extraStops.forEach(stop => {
                            stop.style.opacity = '0';
                            stop.style.transform = 'translateX(-20px)';
                            setTimeout(() => {
                                stop.classList.add('hidden');
                                stop.style.display = 'none';
                            }, 300);
                        });
                    }
                });
                
                expandBtn.setAttribute('data-initialized', 'true');
                console.log('‚úÖ Funcionalidade de expandir inicializada');
            }
        }
        
        // Inicializar quando DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initExpandFunctionality);
        } else {
            initExpandFunctionality();
        }
        
        // Backup: tentar novamente ap√≥s 1 segundo
        setTimeout(initExpandFunctionality, 1000);
    </script>
</body>
</html>